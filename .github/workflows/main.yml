name: Node.js App CI

on:
  push:
    branches:
      - main

jobs:
  build:
    permissions:
      contents: write
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v2

      # 3️⃣ Run your custom action or test
      - name: Test
        uses: zakarialaoui10/master@main
        env: 
          OWNER: ${{ github.repository_owner }}
          REPO: ${{ github.event.repository.name }}
          CUSTOM : "CUSTOM MSG"

      # 4️⃣ Commit & Push changes safely
      - name: Commit & Push
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add -A .
          git commit -m "generated by zakarialaoui10/master" || echo "No changes to commit"
          # Pull remote changes first to avoid rejection
          git pull --rebase
          git push 
        env:
          CUSTOM_TOKEN: ${{ secrets.CUSTOM_TOKEN }}
